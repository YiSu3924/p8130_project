---
title: "bm-project"
author: "YISU"
date: "2024-12-19"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(MASS)
library(leaps)
```

```{r}
# Load necessary libraries
library(tidyverse)
library(broom)
library(GGally)
library(gridExtra)


# Read the dataset
data <- read.csv("Project_1_data.csv")

# Inspect the structure of the data
glimpse(data)


hist_math <- ggplot(data, aes(x = MathScore)) +
  geom_histogram(binwidth = 5, fill = "steelblue", color = "black") +
  labs(title = "Histogram of Math Scores", x = "Math Score", y = "Frequency")

hist_reading <- ggplot(data, aes(x = ReadingScore)) +
  geom_histogram(binwidth = 5, fill = "firebrick", color = "black") +
  labs(title = "Histogram of Reading Scores", x = "Reading Score", y = "Frequency")

hist_writing <- ggplot(data, aes(x = WritingScore)) +
  geom_histogram(binwidth = 5, fill = "darkgreen", color = "black") +
  labs(title = "Histogram of Writing Scores", x = "Writing Score", y = "Frequency")
box_nr_siblings <- ggplot(data, aes(y = NrSiblings)) +
  geom_boxplot(fill = "lightblue") +
  labs(title = "Boxplot of Number of Siblings", y = "Number of Siblings")

box_wkly_study_hours <- ggplot(data, aes(y = WklyStudyHours)) +
  geom_boxplot(fill = "lightgreen") +
  labs(title = "Boxplot of Weekly Study Hours", y = "Weekly Study Hours")
scatter_math_reading <- ggplot(data, aes(x = ReadingScore, y = MathScore)) +
  geom_point(color = "darkblue") +
  labs(title = "Math Score vs. Reading Score", x = "Reading Score", y = "Math Score")

scatter_reading_writing <- ggplot(data, aes(x = WritingScore, y = ReadingScore)) +
  geom_point(color = "darkred") +
  labs(title = "Reading Score vs. Writing Score", x = "Writing Score", y = "Reading Score")
# Convert categorical variables to factors if needed
data <- data %>%
  mutate(across(c(Gender, EthnicGroup, ParentEduc, LunchType, TestPrep, 
                  ParentMaritalStatus, PracticeSport, IsFirstChild, 
                  TransportMeans, WklyStudyHours), as.factor))

pairwise_plots <- ggpairs(data,
  columns = c("MathScore", "ReadingScore", "WritingScore", "NrSiblings", "WklyStudyHours"),
  aes(color = Gender),
  lower = list(continuous = "smooth"),
  upper = list(continuous = "cor"),
  diag = list(continuous = "densityDiag"))
grid.arrange(
  hist_math, hist_reading, hist_writing,
  box_nr_siblings, box_wkly_study_hours,
  scatter_math_reading, scatter_reading_writing,
  ncol = 2
)
```


```{r}
data$Gender <- as.factor(data$Gender)
data$EthnicGroup <- as.factor(data$EthnicGroup)
data$ParentEduc <- as.factor(data$ParentEduc)
data$LunchType <- as.factor(data$LunchType)
data$TestPrep <- as.factor(data$TestPrep)
data$ParentMaritalStatus <- as.factor(data$ParentMaritalStatus)
data$PracticeSport <- as.factor(data$PracticeSport)
data$IsFirstChild <- as.factor(data$IsFirstChild)
data$TransportMeans <- as.factor(data$TransportMeans)
data$WklyStudyHours <- as.factor(data$WklyStudyHours)

# Handle missing values by removing rows with NA
data <- na.omit(data)

# Define the full model for MathScore
math_full_model <- lm(MathScore ~ Gender + EthnicGroup + ParentEduc + LunchType + TestPrep +
                        ParentMaritalStatus + PracticeSport + IsFirstChild + NrSiblings +
                        TransportMeans + WklyStudyHours, data = data)

# Perform stepwise model selection
math_selected_model <- stepAIC(math_full_model, direction = "both", trace = FALSE)
math_selected_model
# Display the summary of the selected model
cat("\nSelected Model for MathScore:\n")
summary(math_selected_model)

# Make predictions using the selected model
math_predictions <- predict(math_selected_model, newdata = data)

# Combine actual and predicted values for MathScore
math_results <- data.frame(
  Actual_MathScore = data$MathScore,
  Predicted_MathScore = math_predictions
)

# Save results to a CSV file
write.csv(math_results, "math_score_predictions.csv", row.names = FALSE)
```

```{r}
best_subset_math = regsubsets(MathScore ~ Gender + EthnicGroup + ParentEduc + LunchType + TestPrep + ParentMaritalStatus + PracticeSport + IsFirstChild + TransportMeans + WklyStudyHours + NrSiblings, data = data, nvmax = 11)
best_summary = summary(best_subset_math)
plot(best_summary$adjr2, type = "b",
xlab = "number of predictors",
ylab = "adjusted Rˆ2",
main = "adjusted Rˆ2 for subsets")
best_num_predictors <- which.max(best_summary$adjr2)
selected_predictors <- names(coef(best_subset_math, best_num_predictors))
cat("Selected predictors for the best model:\n")
print(selected_predictors)
```


```{r}
par(mfrow = c(2, 2)) 
plot(math_selected_model)
par(mfrow = c(1, 1))
```

```{r}
reading_full_model <- lm(ReadingScore ~ Gender + EthnicGroup + ParentEduc + LunchType + TestPrep +
                        ParentMaritalStatus + PracticeSport + IsFirstChild + NrSiblings +
                        TransportMeans + WklyStudyHours, data = data)

# Perform stepwise model selection
reading_selected_model <- stepAIC(reading_full_model, direction = "both", trace = FALSE)
reading_selected_model
# Display the summary of the selected model
cat("\nSelected Model for Reading:\n")
summary(reading_selected_model)

# Make predictions using the selected model
reading_predictions <- predict(reading_selected_model, newdata = data)

# Combine actual and predicted values for MathScore
reading_results <- data.frame(
  Actual_ReadingScore = data$ReadingScore,
  Predicted_ReadingScore = reading_predictions
)

# Save results to a CSV file
write.csv(reading_results, "reading_score_predictions.csv", row.names = FALSE)
```


```{r}
par(mfrow = c(2, 2)) 
plot(reading_selected_model)
par(mfrow = c(1, 1))
```

```{r}
writing_full_model <- lm(WritingScore ~ Gender + EthnicGroup + ParentEduc + LunchType + TestPrep +
                        ParentMaritalStatus + PracticeSport + IsFirstChild + NrSiblings +
                        TransportMeans + WklyStudyHours, data = data)

# Perform stepwise model selection
writing_selected_model <- stepAIC(writing_full_model, direction = "both", trace = FALSE)
writing_selected_model
# Display the summary of the selected model
cat("\nSelected Model for WritingScore:\n")
summary(writing_selected_model)

# Make predictions using the selected model
writing_predictions <- predict(writing_selected_model, newdata = data)

# Combine actual and predicted values for MathScore
writing_results <- data.frame(
  Actual_WritingScore = data$WritingScore,
  Predicted_WritingScore = writing_predictions
)

# Save results to a CSV file
write.csv(writing_results, "writing_score_predictions.csv", row.names = FALSE)
```


```{r}
par(mfrow = c(2, 2)) 
plot(writing_selected_model)
par(mfrow = c(1, 1))
```


Summary of the the predit model
```{r}
# Fit the three linear models
model1 <- lm(formula = ReadingScore ~ Gender + EthnicGroup + ParentEduc + 
               LunchType + TestPrep + ParentMaritalStatus + IsFirstChild, data = data)

model2 <- lm(formula = MathScore ~ Gender + EthnicGroup + ParentEduc + 
               LunchType + TestPrep + ParentMaritalStatus + IsFirstChild + WklyStudyHours, 
             data = data)

model3 <- lm(formula = WritingScore ~ Gender + EthnicGroup + ParentEduc + 
               LunchType + TestPrep + ParentMaritalStatus + WklyStudyHours, data = data)
```

```{r}
summary(data$MathScore)  # Inspect the range of MathScore
```

```{r}
data$MathScore_shifted <- data$MathScore + 1
model2_shifted <- lm(MathScore_shifted ~ Gender + EthnicGroup + ParentEduc + 
                       LunchType + TestPrep + ParentMaritalStatus + IsFirstChild + 
                       WklyStudyHours, data = data)

```
```


```{r}
# Set up a 1-row, 3-column layout
par(mfrow = c(1, 3))

# Box-Cox analysis for model1
boxcox(model1, lambda = seq(-2, 2, by = 0.1))  # Range of lambda values
title("Model 1: ReadingScore")

# Box-Cox analysis for model2
boxcox(model2_shifted, lambda = seq(-2, 2, by = 0.1))  # Range of lambda values
title("Model 2: MathScore")

# Box-Cox analysis for model3
boxcox(model3, lambda = seq(-2, 2, by = 0.1))  # Range of lambda values
title("Model 3: WritingScore")

# Reset graphical parameters (optional)
par(mfrow = c(1, 1))
```